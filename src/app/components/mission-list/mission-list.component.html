<div class="not-allowed-text" *ngIf="!(discordUser && discordUser.role)">
	You must join our Discord server and complete the welcoming process to see our mission list!
</div>
<div [class.not-allowed-overlay]="!(discordUser && discordUser.role)"></div>
<div class="flexrow">
	<div class="controlsColumn">
		<div class="controlsContainer" [formGroup]="filterGroup">
			<!--TODO: Prettify this and add more controls-->
			<mat-form-field class="searchFilter mt-4">
				<mat-label>Search Filter</mat-label>
				<input matInput (keyup)="applyFilter($event)" placeholder="Search Term" #input>
			</mat-form-field>
			<mat-form-field appearance="fill">
				<mat-label>Type:</mat-label>
				<mat-select value="ALL" formControlName="misType">
					<mat-option value="ALL">ALL</mat-option>
					<mat-option *ngFor="let type of mC.MissionTypes" value="type.title">{{type.title}}</mat-option>
				</mat-select>
			</mat-form-field>
			<mat-form-field appearance="fill">
				<mat-label>Terrain:</mat-label>
				<mat-select value="ALL" formControlName="misTerrain">
					<mat-option value="ALL">ALL</mat-option>
					<mat-option *ngFor="let item of mC.MissionTerrains | keyvalue" [value]="item.value.class">{{item.value.name}}</mat-option>
				</mat-select>
			</mat-form-field>
			<mat-form-field appearance="fill">
				<mat-label>Time:</mat-label>
				<mat-select value="ALL" formControlName="misTime">
					<mat-option value="ALL">ALL</mat-option>
					<mat-option *ngFor="let time of mC.MissionTimes" value="time">{{time}}</mat-option>
				</mat-select>
			</mat-form-field>
			<mat-form-field appearance="fill">
				<mat-label>Era:</mat-label>
				<mat-select value="ALL" formControlName="misEra">
					<mat-option value="ALL">ALL</mat-option>
					<mat-option *ngFor="let era of mC.MissionEras" value="era">{{era}}</mat-option>
				</mat-select>
			</mat-form-field>
			<mat-form-field>
				<mat-label>Tags</mat-label>
				<mat-select formControlName="misTags" multiple #missionTags>
					<mat-select-trigger>
						<mat-chip-list>
							<mat-chip
								*ngFor="let tag of filterGroup.get('misTags')?.value; let matChipIndex = index"
								[removable]="true" (removed)="onListChipRemoved(missionTags, matChipIndex)">
								{{ tag }}
								<mat-icon matChipRemove>cancel</mat-icon>
							</mat-chip>
						</mat-chip-list>
					</mat-select-trigger>
					<mat-option *ngFor="let tag of mC.MissionTags" [value]="tag">{{tag}}
					</mat-option>
				</mat-select>
			</mat-form-field>
		</div>
	</div>
	<div class="tableColumn mr-2">
		<table mat-table [dataSource]="this.dataSource" class="matTable" matSort>
			<ng-container matColumnDef="name">
				<th mat-header-cell *matHeaderCellDef mat-sort-header> Name </th>
				<td mat-cell *matCellDef="let element">{{element.name}}</td>
			</ng-container>
			<ng-container matColumnDef="type">
				<th mat-header-cell *matHeaderCellDef mat-sort-header> Type </th>
				<td mat-cell *matCellDef="let element">{{element.type}}</td>
			</ng-container>
			<ng-container matColumnDef="min">
				<th mat-header-cell *matHeaderCellDef mat-sort-header> Min Players </th>
				<td mat-cell *matCellDef="let element">{{element.size[0]}}</td>
			</ng-container>
			<ng-container matColumnDef="max">
				<th mat-header-cell *matHeaderCellDef mat-sort-header> Max Players </th>
				<td mat-cell *matCellDef="let element">{{element.size[1]}}</td>
			</ng-container>
			<ng-container matColumnDef="terrain">
				<th mat-header-cell *matHeaderCellDef mat-sort-header> Terrain </th>
				<td mat-cell *matCellDef="let element">{{element.terrain}}</td>
			</ng-container>
			<ng-container matColumnDef="era">
				<th mat-header-cell *matHeaderCellDef mat-sort-header> Era </th>
				<td mat-cell *matCellDef="let element">{{element.era}}</td>
			</ng-container>
			<ng-container matColumnDef="author">
				<th mat-header-cell *matHeaderCellDef mat-sort-header> Author </th>
				<td mat-cell *matCellDef="let element">{{element.author}}</td>
			</ng-container>
			<ng-container matColumnDef="version">
				<th mat-header-cell *matHeaderCellDef mat-sort-header> Version </th>
				<td mat-cell *matCellDef="let element">{{element.version}}</td>
			</ng-container>
			<tr mat-header-row *matHeaderRowDef="displayedColumns; sticky: true"></tr>
			<tr mat-row *matRowDef="let row; columns: displayedColumns;" (click)="onActivate(row)"></tr>

			<!-- Row shown when there is no matching data. -->
			<tr class="mat-row" *matNoDataRow>
				<td class="mat-cell" colspan="4">No data matching the filter "{{input.value}}"</td>
			</tr>
		</table>
		<mat-paginator [pageSizeOptions]="[5, 10, 25, 100]"></mat-paginator>
	</div>
</div>